<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="http://cdn.webix.com/edge/webix.js"></script>
  <link rel="stylesheet" type="text/css" href="http://cdn.webix.com/edge/webix.css">
  <link rel="stylesheet" href="./style.css">
  <script src="./testdata.js"></script>
</head>

<body>
  <script>
    let label = {
      view: "label",
      label: "My App",
    };

    let btn = {
      view: "button",
      type: "icon", icon: "wxi-user", label: "Profile",
      width: 100,
      css: 'webix_transparent',
      popup: 'my_pop'
    }


    let row1 = {
      view: "toolbar",
      css: "webix_dark",
      paddingX: 10,
      cols: [
        label,
        btn
      ]
    };

    let sidebar = {
      minHeight: 300,
      id: "mylist",
      css: "sidebar",
      view: "sidebar",
      width: 200,
      scroll: false,
      data: ["Dashboard", "Users", "Products", "Locations"],
      borderless: true,
      on: {
        onAfterSelect: function (id) {
          $$(id).show();
        }
      }
    };

    let connected = {
      view: "label",
      align: "center",
      label: "<span class='webix_icon wxi wxi-check'></span>Connected",
      css: "connect_label",
    }

    let side = {
      css: "sidebar",
      rows: [
        sidebar,
        connected
      ]
    };

    let datatable = {
      id: "mydata",
      view: "datatable",
      url: "./data.js",
      autoConfig: true,
      scroll: 'auto',
      editable: true,
      hover: "myhover",
      columns: [
        { id: "rank", header: "", css: "rank", width: 40, sort: "int" },
        { id: "title", header: ["Film title", { content: "textFilter" }], fillspace: true, sort: "string" },
        { id: "year", header: ["Released", { content: "textFilter" }], width: 80, sort: "int", tooltip: "" },
        { id: "votes", header: ["Votes", { content: "textFilter" }], width: 80, sort: "int", tooltip: "" },
        {
          view: "button", template: "{common.trashIcon()}", width: 50
        }

      ],
      onClick: {
        "wxi-trash": function (e, id) {
          this.remove(id);
          return false;
        }
      }
    }

    let form = {
      view: "form",
      id: "myform",
      width: 300,
      elements: [
        {
          view: "fieldset", label: "Edit films",
          body: {
            rows: [
              { view: "text", label: "Title", name: 'title', invalidMessage: 'Title is empty' },
              { view: "text", label: "Year", name: 'year', invalidMessage: 'Incorrect year' },
              { view: "text", label: "Rating", name: 'rating', invalidMessage: 'Rating is empty' },
              { view: "text", label: "Votes", name: 'votes', invalidMessage: 'Incorrect votes' }
            ]
          }
        },
        {
          cols: [
            {
              view: "button", value: "Add new", css: 'webix_primary', click: function () {
                if ($$("myform").validate()) {
                  let item = $$("myform").getValues();
                  $$("mydata").add(item);
                  webix.message({ type: 'success', text: "Database updated", expire: 1000 })
                }
              }
            },
            {
              view: "button", value: "Clear", click: function () {
                webix.confirm({
                  title: "Warning!",
                  type: "confirm-warning",
                  text: "You are about to agree. Are you sure?"
                })
                  .then(function () {
                    $$('myform').clear()
                    $$("myform").clearValidation();
                  })
                  .fail(function () {
                    webix.message("Cleanup canceled.");
                  })

              }
            }
          ],
        },
        {}
      ],
      rules: {
        title: webix.rules.isNotEmpty,
        year: function (value) {
          return value > 1970 && value < 2022;
        },
        votes: function (value) {
          return value < 100000;
        },
        rating: webix.rules.isNotEmpty && function (value) {
          return value > 0;
        }
      }
    };

    const list = {
      view: 'list',
      url: './users.js',
      data: ['name', 'country'],
      header: ["Votes", { content: "textFilter" }]
    }

    const chart = {
      view: "chart",
      type: "bar",
      url: './users.js',
      value: 'age',
      barWidth: 35,
      radius: 0,
      gradient: "falling",
    }

    const treetable = {
      view: "tree",
      template: "{common.icon()} {common.checkbox()} {common.folder()} <span>#value#</span>",
      select: true,
      url: './products.js'
    }

    let main = {
      cells: [
        { id: "Dashboard", cols: [datatable, form] },
        { id: "Users", rows: [list, chart] },
        { id: "Products", rows: [treetable] },
        { id: "Locations", template: "Empty view" }
      ]
    }

    let row2 = {
      cols: [
        side,
        { view: "resizer" },
        main
      ]
    };

    let row3 = {
      template: `<div class="copyright"> The software is provided by <a href="https://webix.com/" target="_blank">webix.com.</a> All rights are reserved. (c) </div>`,
      align: "center",
      height: 30
    }

    webix.ui({
      view: "popup",
      id: "my_pop",

      width: 300,
      body: {
        view: "list",
        data: [
          { id: "1", name: "Settings" },
          { id: "2", name: "Log Out" },
        ],
        template: "#name#",
        autoheight: true,
        select: true
      }
    });

    webix.ui({
      rows: [
        row1,
        row2,
        row3
      ]
    });
  </script>
  <style>
    .connect_label .webix_el_box,
    .connect_label .wxi-check {
      color: rgb(125, 160, 64);
    }

    .copyright {
      text-align: center
    }

    .sidebar {
      background-color: rgb(234, 234, 234);
    }

    .sidebar .webix_tree_item:hover,
    .sidebar .webix_tree_item.webix_selected,
    .sidebar .webix_tree_item.webix_selected:active {
      background-color: rgb(225, 225, 225);
    }
  </style>
</body>

</html>